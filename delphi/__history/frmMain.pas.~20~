unit frmMain;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Pix4, Registry;

type
  TfrmPix4 = class(TForm)
    Button1: TButton;
    memoLogs: TMemo;
    Button2: TButton;
    txtPort: TEdit;
    Button3: TButton;
    Button4: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    pix4 : tpix4;
    PortHandle : THandle;
  end;

var
  frmPix4: TfrmPix4;

implementation

{$R *.dfm}

procedure TfrmPix4.Button1Click(Sender: TObject);
var
  portList : TStringList;
  I: Integer;
begin
  memologs.Clear;
  pix4 := tpix4.Create;
  portList := TStringList.Create;
  pix4.LoadSerialPorts(portList);
  memoLogs.Lines.AddStrings(portList);
end;

procedure TfrmPix4.Button2Click(Sender: TObject);
begin
  try
    PortHandle := pix4.OpenSerialPort(txtPort.Text);
    try
      // connection opened successfully, do further operations...
      ShowMessage('Connection opened');
    finally
      // close the connection
      // CloseHandle(PortHandle);
    end;
  except on E: Exception do begin
      Writeln('Failed to open COM port: ', E.Message);
      ShowMessage('connection failed');
    end;
  end;
end;

procedure TfrmPix4.Button3Click(Sender: TObject);
begin
  Pix4.Disconnect(PortHandle);
end;

procedure TfrmPix4.Button4Click(Sender: TObject);
var
  temp : integer;
begin
  temp := Pix4.IOBterVersaoFirmware;
  memoLogs.Lines.Add(inttoStr(temp));
end;

end.
